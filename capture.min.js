/*!
 * Capture 0.1.3
 * (c) 2013 Dan Roberts, Ogilvy & Mather Atlanta
 * Capture may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://eatarandom.github.com/capture/
 */
!function(){"use strict";function a(a){this.cid=l("ce"),i(this,i(h,a)),this.id<0&&(this.id=this.cid),this.initialize.call(this)}function b(a){this.cid=l("provider"),this.options=a,this.initialize.apply(this,arguments)}function c(a){this.version=f,this.events=[],this.providers=[],i(this,i(g,a)),this.initialize.apply(this,arguments)}var d=this,e=d.Zepto||d.jQuery||d.$,f="0.1.3",g={debug:!1,delay:!1},h={parent_selector:"body",selector:"div",action:"click",type:"track",props:{}},i=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},j=function(a){var b=this,c=function(){return b.apply(this,arguments)};i(c,b);var d=function(){this.constructor=c};return d.prototype=b.prototype,c.prototype=new d,a&&i(c.prototype,a),c.__super__=b.prototype,c},k=0,l=function(a){var b=++k+"";return a?a+b:b},m=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)b[b.length]=c;return b},n=function(a,b){for(var c=m(a),d=0,e=c.length;e>d;d++){var f=c[d];"function"==typeof a[f]&&(a[f]=a[f].call(b))}return a},o=function(a,b,c){var d=0,e=a.length;for(d;e>d;d++)b.call(c,a[d],d,a)},p=function(a){var b=[];for(var c in a)b.push(a[c]);return b},q=function(){function a(){this.subjects={}}return i(a.prototype,{publish:function(a,b,c){var d=this.subjects;d.hasOwnProperty(a)&&o(d[a],function(a){a.callback.call(a[c],b,c)})},subscribe:function(a,b,c){var d=this.subjects;d.hasOwnProperty(a)||(d[a]=[]),d[a].push({context:c||this,callback:b})}}),{evt:{track:"track",pageview:"pageview"},mediator:new a}}.call(d);i(a.prototype,i(q,{initialize:function(){var a=this;if(!this.parent_selector||!this.parent_selector.length)throw new Error("CaptureEvent #"+this.id+" needs a valid parent_selector");if(!this.selector||!this.selector.length)throw new Error("CaptureEvent #"+this.id+" needs a valid selector");"string"==typeof this.type&&(this.type=this.type.split()),this.parent_selector=e(this.parent_selector),this.parent_selector.on(this.action,this.selector,function(b){a.publish(b)})},publish:function(a){var b=this;o(b.type,function(c){b.mediator.publish(c,n(b.props,a.target),b)})}})),i(b.prototype,i(q,{initialize:function(){this.mediator.subscribe(this.evt.track,this.track,this),this.mediator.subscribe(this.evt.pageview,this.pageview,this),this.setup.call(this)},setup:function(){},track:function(){},pageview:function(){}})),b.extend=j;var r=function(){var a={gaq:{name:"GoogleAnalytics",options:{account:"UA-XXXXX-X"},methods:{setup:function(){d._gaq=d._gaq||[],d._gaq.push(["_setAccount",this.options.account]),d._gaq.push(["_trackPageview"]);var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)},track:function(a){console.log("gaq track ",p(a)),d._gaq.push(["_trackEvent",p(a)])},pageview:function(a){var b=document.location.pathname;a&&a.url&&(b=a.url),console.log("gaq pageview ",b),d._gaq.push(["_trackPageview",b])}}}},b=function(b){return a[b]?a[b]:!1};return{get:b}}.call(d);i(c.prototype,i(q,{initialize:function(a){var b=a,c=this,d=b.events,e=b.providers;b&&(d&&d.length&&o(d,function(a){c.events.push(c.addEvent(a))}),e&&e.length&&o(e,function(a){c.providers.push(c.addProvider(a))}))},addProvider:function(a){var c=r.get(a.name);c&&(c=i(c,a));var d=b.extend(c.methods);return new d(c.options)},removeProvider:function(){},addEvent:function(b){return new a(b)},removeEvent:function(){},track:function(a){this.mediator.publish("track",a,this)},pageview:function(a){this.mediator.publish("pageview",a,this)}}));var s=!1;"undefined"!=typeof module&&module.exports&&(module.exports=c,s=!0);var t=!1;"function"==typeof define&&define.amd&&(define("Capture",[],function(){return c}),t=!0),s||t||(d.Capture=c)}.call(this);