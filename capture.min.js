/*!
 * Capture 0.1.5
 * (c) 2013 Dan Roberts, Ogilvy & Mather Atlanta
 * Capture may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://eatarandom.github.com/capture/
 */
!function(){"use strict";function a(a){this.cid=k("ce"),this.defaults={parent_selector:"html",selector:"div",action:"click",type:"track",props:{}},h(this,h(this.defaults,a)),this.id<0&&(this.id=this.cid),this.initialize.call(this)}function b(a){this.cid=k("provider"),this.options=a,this.initialize.apply(this,arguments)}function c(a){this.version=f,this.events=[],this.providers=[],h(this,h(g,a)),this.initialize.apply(this,arguments)}var d=this,e=d.Zepto||d.jQuery||d.$,f="0.1.5",g={debug:!1,delay:!1},h=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},i=function(a){var b=this,c=function(){return b.apply(this,arguments)};h(c,b);var d=function(){this.constructor=c};return d.prototype=b.prototype,c.prototype=new d,a&&h(c.prototype,a),c.__super__=b.prototype,c},j=0,k=function(a){var b=++j+"";return a?a+b:b},l=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)b[b.length]=c;return b},m=function(a,b,c){for(var d=l(a),e={},f=0,g=d.length;g>f;f++){var h=d[f];"function"==typeof a[h]&&(e[h]=a[h].call(b,c))}return e},n=function(a,b,c){var d=0,e=a.length;for(d;e>d;d++)b.call(c,a[d],d,a)},o=function(a){var b=[];for(var c in a)b.push(a[c]);return b},p=function(){function a(){this.subjects={}}return h(a.prototype,{publish:function(a,b,c){var d=this.subjects;d.hasOwnProperty(a)&&n(d[a],function(a){a.callback.call(a[c],b,c)})},subscribe:function(a,b,c){var d=this.subjects;d.hasOwnProperty(a)||(d[a]=[]),d[a].push({context:c||this,callback:b})}}),{evt:{track:"track",pageview:"pageview"},mediator:new a}}.call(d);h(a.prototype,h(p,{initialize:function(){var a=this;if(!this.parent_selector||!this.parent_selector.length)throw new Error("CaptureEvent #"+this.id+" needs a valid parent_selector");if(!this.selector||!this.selector.length)throw new Error("CaptureEvent #"+this.id+" needs a valid selector");"string"==typeof this.type&&(this.type=this.type.split()),this.parent_selector=e(this.parent_selector),this.parent_selector.on(this.action,this.selector,function(b,c){a.publish(b,c)})},publish:function(a,b){var c=this;n(c.type,function(d){c.mediator.publish(d,m(c.props,a.target,b),c)})}})),h(b.prototype,h(p,{initialize:function(){this.mediator.subscribe(this.evt.track,this.track,this),this.mediator.subscribe(this.evt.pageview,this.pageview,this),this.setup.call(this)},setup:function(){},track:function(){},pageview:function(){}})),b.extend=i;var q=function(){var a={gaq:{name:"GoogleAnalytics",options:{account:"UA-XXXXX-X"},methods:{setup:function(){d._gaq=d._gaq||[],d._gaq.push(["_setAccount",this.options.account]),d._gaq.push(["_trackPageview"]);var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)},track:function(a){d._gaq.push(["_trackEvent",o(a)])},pageview:function(a){var b=document.location.pathname;a&&a.url&&(b=a.url),d._gaq.push(["_trackPageview",b])}}}},b=function(b){return a[b]?a[b]:!1};return{get:b}}.call(d);h(c.prototype,h(p,{initialize:function(a){var b=a,c=this,d=b.events,e=b.providers;b&&(d&&d.length&&n(d,function(a){c.events.push(c.addEvent(a))}),e&&e.length&&n(e,function(a){c.providers.push(c.addProvider(a))}))},addProvider:function(a){var c=q.get(a.name);c&&(c=h(c,a));var d=b.extend(c.methods);return new d(c.options)},removeProvider:function(){},addEvent:function(b){return new a(b)},removeEvent:function(){},track:function(a){this.mediator.publish("track",a,this)},pageview:function(a){this.mediator.publish("pageview",a,this)}}));var r=!1;"undefined"!=typeof module&&module.exports&&(module.exports=c,r=!0);var s=!1;"function"==typeof define&&define.amd&&(define("Capture",[],function(){return c}),s=!0),r||s||(d.Capture=c)}.call(this);