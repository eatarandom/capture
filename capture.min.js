/*!
 * Capture 0.2.2
 * (c) 2014 Dan Roberts
 * Capture may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://eatarandom.github.com/capture/
 */
!function(){"use strict";function a(a,b){this.cid=j("event"),this.capture=a,this.defaults={id:"",parent_selector:"html",selector:"",action:"",type:"",delay:!1,prevent:!1,props:null},h(this,h(this.defaults,b)),this.initialize.apply(this,b),a.debug&&g("Created Event",this.toString(),this)}function b(a){this.version=f,this.defaults={debug:!1,events:[],config:null,provider:null,provider_config:null},h(this,h(this.defaults,a)),this.debug=this.debug||/[?&]capture=true/.test(location.href),this.debug&&g("Initialized"),this.initialize.apply(this,arguments),this.debug&&g("Loaded",this)}function c(a){this.defaults={debug:!1,account:"",namespace:"ga",props:null},h(this,h(this.defaults,a)),this.initialize.apply(this,arguments)}var d=this,e=d.Zepto||d.jQuery||d.$,f="0.2.2",g=function(){g.history=g.history||[],g.history.push(arguments),d.console&&console.log("Capture",Array.prototype.slice.call(arguments))},h=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},i=0,j=function(a){var b=++i+"";return a?a+b:b},k=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)b[b.length]=c;return b},l=function(a,b){for(var c=k(a),d={},e=0,f=c.length;f>e;e++){var g=c[e];d[g]="function"==typeof a[g]?a[g].call(b):a[g]}return d},m=function(a,b,c){var d=0,e=a.length;for(d;e>d;d++)b.call(c,a[d],d,a)},n=function(a){var b=[];for(var c in a)b.push(a[c]);return b};h(a.prototype,{initialize:function(){var a=this;if(!this.parent_selector||!this.parent_selector.length)throw new Error("CaptureEvent #"+this.id+" needs a valid parent_selector");if(!this.selector||!this.selector.length)throw new Error("CaptureEvent #"+this.id+" needs a valid selector");e(this.parent_selector).on(a.action,a.selector,function(b){a.prevent&&b.preventDefault(),a.message({type:a.type,props:a.props,context:b.target})})},message:function(a){this.capture.message(a)},toString:function(){return"CaptureEvent "+this.id}}),h(b.prototype,{initialize:function(a){var b=this;b.debug&&g("Looping over events",b.config),m(b.config,function(a){b.createEvent(a,function(a){b.events[b.events.length]=a})}),a.provider||(b.provider=new c({debug:b.debug,account:b.provider_config.account,namespace:b.provider_config.namespace,props:b.provider_config.props}))},createEvent:function(b,c){c&&"function"==typeof c&&c.call(this,new a(this,b))},message:function(a){var b=this;b.provider.send(a,function(){b.debug&&g("Success")})}}),h(c.prototype,{initialize:function(){this.load(this.account,this.props)},load:function(a,b){!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js",this.namespace),d[this.namespace]("create",a,b),d[this.namespace]("send","pageview")},send:function(a,b){var c=l(a.props,a.context);this.debug&&g("Sending",a.type,n(c).join(",")),c.hitCallback=b,d[this.namespace]("send",a.type,c)}});var o=!1;"undefined"!=typeof module&&module.exports&&(module.exports=b,o=!0);var p=!1;"function"==typeof define&&define.amd&&(define("Capture",[],function(){return b}),p=!0),o||p||(d.Capture=b)}.call(this);