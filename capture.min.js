/*!
 * Capture 0.1.0-beta
 * (c) 2013 Dan Roberts, Ogilvy & Mather Atlanta
 * Capture may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://eatarandom.github.com/capture/
 */
(function(){"use strict";function t(t){this.cid=h("ce"),c(this,c(a,t)),0>this.id&&(this.id=this.cid),this.initialize.call(this)}function e(t){this.cid=h("provider"),this.options=t,this.initialize.apply(this,arguments)}function i(t){this.version=o,this.events=[],this.providers=[],c(this,c(s,t)),this.initialize.apply(this,arguments)}var n=this,r=n.Zepto||n.jQuery||n.$,o="0.1.0-beta",s={debug:!1,delay:!1},a={selector:"body",action:"click",type:"track",props:{}},c=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},u=function(t){var e=this,i=function(){return e.apply(this,arguments)};c(i,e);var n=function(){this.constructor=i};return n.prototype=e.prototype,i.prototype=new n,t&&c(i.prototype,t),i.__super__=e.prototype,i},p=0,h=function(t){var e=++p+"";return t?t+e:e},l=Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)e[e.length]=i;return e},v=function(t,e){for(var i=l(t),n=0,r=i.length;r>n;n++){var o=i[n];"function"==typeof t[o]&&(t[o]=t[o].call(e))}return t},f=function(t,e,i){var n=0,r=t.length;for(n;r>n;n++)e.call(i,t[n],n,t)},d=function(t){var e=[];for(var i in t)e.push(t[i]);return e},g=function(){function t(){this.subjects={}}return c(t.prototype,{publish:function(t,e,i){var n=this.subjects;n.hasOwnProperty(t)&&f(n[t],function(t){t.callback.call(t[i],e,i)})},subscribe:function(t,e,i){var n=this.subjects;n.hasOwnProperty(t)||(n[t]=[]),n[t].push({context:i||this,callback:e})}}),{evt:{track:"track",pageview:"pageview"},mediator:new t}}.call(n);c(t.prototype,c(g,{initialize:function(){var t=this;if(this.selector=r(this.selector),!this.selector||!this.selector.length)throw Error("CaptureEvent"+this.id+"needs a valid selector");"string"==typeof this.type&&(this.type=this.type.split()),this.selector.on(this.action,function(e){t.publish(e)})},publish:function(t){var e=this;t.preventDefault(),f(e.type,function(i){e.mediator.publish(i,v(e.props,t.target),e)})}})),c(e.prototype,c(g,{initialize:function(){this.mediator.subscribe(this.evt.track,this.track,this),this.mediator.subscribe(this.evt.pageview,this.pageview,this),this.setup.call(this)},setup:function(){},track:function(){},pageview:function(){}})),e.extend=u;var y=function(){var t={gaq:{name:"GoogleAnalytics",options:{account:"UA-XXXXX-X"},methods:{setup:function(){var t=n._gaq;t=t||[],t.push(["_setAccount",this.options.account]),t.push(["_trackPageview"]);var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)},track:function(t){console.log("gaq track ",d(t)),n._gaq.push(["_trackEvent",d(t)])},pageview:function(t){var e=document.location.pathname;t&&t.url&&(e=t.url),console.log("gaq pageview ",e),n._gaq.push(["_trackPageview",e])}}}},e=function(e){return t[e]?t[e]:!1};return{get:e}}.call(n);c(i.prototype,c(g,{initialize:function(t){var e=t,i=this,n=e.events,r=e.providers;e&&(n&&n.length&&f(n,function(t){i.events.push(i.addEvent(t))}),r&&r.length&&f(r,function(t){i.providers.push(i.addProvider(t))}))},addProvider:function(t){var i=y.get(t.name);i&&(i=c(i,t));var n=e.extend(i.methods);return new n(i.options)},removeProvider:function(){},addEvent:function(e){return new t(e)},removeEvent:function(){},track:function(t){this.mediator.publish("track",t,this)},pageview:function(t){this.mediator.publish("pageview",t,this)}}));var m=!1;"undefined"!=typeof module&&module.exports&&(module.exports=i,m=!0);var w=!1;"function"==typeof define&&define.amd&&(define("Capture",[],function(){return i}),w=!0),m||w||(n.Capture=i)}).call(this);