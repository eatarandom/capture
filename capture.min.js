/*!
 * Capture 0.0.1
 * (c) 2013 Dan Roberts, Ogilvy & Mather Atlanta
 * Capture may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://eatarandom.github.com/capture/
 */
(function(){"use strict";function t(t){this.cid=l("ce"),h(this,h(c,t)),0>this.id&&(this.id=this.cid),this.initialize.call(this)}function i(){}function e(t,i){this.version=o,!t||"object"==typeof t&&!t.length?i=t:this.config=t,h(this,h(s,i)),this.initialize.call(this)}var n=this,r=n.Zepto||n.jQuery||n.$,o="0.0.1",s={debug:!1,delay:!1},c={selector:"body",action:"click",type:"track",props:{}},a=[],h=function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t},u=0,l=function(t){var i=++u+"";return t?t+i:i},p=Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var i=[];for(var e in t)f(t,e)&&(i[i.length]=e);return i},f=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},v=function(t,i){for(var e=p(t),n=0,r=e.length;r>n;n++){var o=e[n];"function"==typeof t[o]&&(t[o]=t[o].call(i))}return t},d=function(){function t(){this.subjects={}}return h(t.prototype,{publish:function(t,i,e){var n=this.subjects;if(n.hasOwnProperty(t))for(var r=0,o=n[t].length;o>r;r++){var s=n[t][r];s.callback.call(e,i)}},subscribe:function(t,i){var e=this.subjects;e.hasOwnProperty(t)||(e[t]=[]),e[t].push({context:this,callback:i})}}),{evt:{track:"track",pageview:"pageview"},mediator:new t}}.call(n);h(t.prototype,h(d,{initialize:function(){var t=this;if(this.selector=r(this.selector),!this.selector||!this.selector.length)throw Error("CaptureEvent"+this.id+"needs a valid selector");"string"==typeof this.type&&(this.type=this.type.split()),this.selector.on(this.action,function(i){t.publish(i)})},publish:function(t){t.preventDefault();for(var i=0,e=this.type.length;e>i;i++)this.mediator.publish(this.type[i],v(this.props,t.target),this)}})),h(i.prototype,h(d,{initialize:function(){this.mediator.subscribe(this.evt.track,this.track),this.mediator.subscribe(this.evt.pageview,this.pageview)},track:function(){},pageview:function(){}})),h(e.prototype,h(d,{initialize:function(){if(this.mediator.subscribe(this.evt.track,this.track),this.mediator.subscribe(this.evt.pageview,this.pageview),this.config&&this.config.length)for(var t=0,i=this.config.length;i>t;t++)this.addCaptureEvent(this.config[t])},addCaptureEvent:function(i){var e=a,n=e.length,r=new t(i);return e[n]=r,r},removeCaptureEvent:function(t){for(var i=0,e=a.length;e>i;i++){var n=a[i];if(n.cid===t)return n}return!1},track:function(t){console.log("tracking",t)},pageview:function(t){console.log("pageview",t)}}));var g=!1;"undefined"!=typeof module&&module.exports&&(module.exports=e,g=!0);var b=!1;"function"==typeof define&&define.amd&&(define("Capture",[],function(){return e}),b=!0),g||b||(n.Capture=e)}).call(this);