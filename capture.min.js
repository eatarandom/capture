/*!
 * Capture 0.0.1
 * (c) 2013 Dan Roberts, Ogilvy & Mather Atlanta
 * Capture may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://eatarandom.github.com/capture/
 */
(function(){"use strict";function t(t){this.cid=h("ce"),c(this,c(a,t)),0>this.id&&(this.id=this.cid),this.initialize.call(this)}function e(t){this.cid=h("provider"),this.options=t,this.initialize.apply(this,arguments)}function i(t){this.version=o,this.events=[],this.providers=[],c(this,c(s,t)),this.initialize.apply(this,arguments)}var n=this,r=n.Zepto||n.jQuery||n.$,o="0.0.1",s={debug:!1,delay:!1},a={selector:"body",action:"click",type:"track",props:{}},c=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},p=function(t){var e=this,i=function(){return e.apply(this,arguments)};c(i,e);var n=function(){this.constructor=i};return n.prototype=e.prototype,i.prototype=new n,t&&c(i.prototype,t),i.__super__=e.prototype,i},u=0,h=function(t){var e=++u+"";return t?t+e:e},l=Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)f(t,i)&&(e[e.length]=i);return e},f=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},v=function(t,e){for(var i=l(t),n=0,r=i.length;r>n;n++){var o=i[n];"function"==typeof t[o]&&(t[o]=t[o].call(e))}return t},d=function(){function t(){this.subjects={}}return c(t.prototype,{publish:function(t,e,i){var n=this.subjects;if(n.hasOwnProperty(t))for(var r=0,o=n[t].length;o>r;r++){var s=n[t][r];s.callback.call(i,e)}},subscribe:function(t,e){var i=this.subjects;i.hasOwnProperty(t)||(i[t]=[]),i[t].push({context:this,callback:e})}}),{evt:{track:"track",pageview:"pageview"},mediator:new t}}.call(n);c(t.prototype,c(d,{initialize:function(){var t=this;if(this.selector=r(this.selector),!this.selector||!this.selector.length)throw Error("CaptureEvent"+this.id+"needs a valid selector");"string"==typeof this.type&&(this.type=this.type.split()),this.selector.on(this.action,function(e){t.publish(e)})},publish:function(t){t.preventDefault();for(var e=0,i=this.type.length;i>e;e++)this.mediator.publish(this.type[e],v(this.props,t.target),this)}})),c(e.prototype,c(d,{initialize:function(){this.mediator.subscribe(this.evt.track,this.track),this.mediator.subscribe(this.evt.pageview,this.pageview),this.setup.call(this)},setup:function(){},track:function(){},pageview:function(){}})),e.extend=p,e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments);var t=n._gaq;t=t||[],t.push(["_setAccount","UA-11"]),t.push(["_trackPageview"]);var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r)},track:function(t){console.log("gaq track ",t)},pageview:function(t){console.log("gaq pageview ",t)}}),c(i.prototype,c(d,{initialize:function(t){var e=t,i=this,n=e.events,r=e.providers;if(e){if(n&&n.length)for(var o=0,s=n.length;s>o;o++)i.events.push(i.addEvent(n[o]));if(r&&r.length)for(var a=0,c=r.length;c>a;a++)i.providers.push(i.addProvider(r[a]))}},addProvider:function(t){var i=e.extend(t.methods);return new i(t.options)},removeProvider:function(){},addEvent:function(e){return new t(e)},removeEvent:function(){},track:function(t){this.mediator.publish("track",t,this)},pageview:function(t){this.mediator.publish("pageview",t,this)}}));var y=!1;"undefined"!=typeof module&&module.exports&&(module.exports=i,y=!0);var g=!1;"function"==typeof define&&define.amd&&(define("Capture",[],function(){return i}),g=!0),y||g||(n.Capture=i)}).call(this);